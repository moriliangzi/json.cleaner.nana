
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>JSON isHidden æ¸…ç†å·¥å…· - å¯éªŒè¯ç‰ˆæœ¬</title>
</head>
<body style="font-family: sans-serif; padding: 20px;">
  <h2>ğŸ§¹ JSON æ¸…ç†å·¥å…·ï¼ˆå¯éªŒè¯ç‰ˆæœ¬ï¼‰</h2>
  <p>æ­¤å·¥å…·ä¼šé€’å›æ‰«ææ•´ä»½ JSON æ¡£æ¡ˆï¼Œåˆ é™¤æ‰€æœ‰å«æœ‰ <code>isHidden: true</code> çš„ç‰©ä»¶ã€‚</p>
  <input type="file" id="fileInput" accept=".json">
  <button onclick="processFile()">â–¶ï¸ ä¸Šä¼ å¹¶æ¸…ç†</button>
  <p id="status" style="color: green; font-weight: bold;"></p>
  <pre><code id="codeBlock" style="background:#f0f0f0; padding:10px; display:block;"></code></pre>

  <script>
    function deepClean(obj) {
      if (Array.isArray(obj)) {
        return obj
          .filter(item => !(item && typeof item === 'object' && item.isHidden === true))
          .map(deepClean);
      } else if (typeof obj === 'object' && obj !== null) {
        const newObj = {};
        for (const key in obj) {
          newObj[key] = deepClean(obj[key]);
        }
        return newObj;
      }
      return obj;
    }

    function processFile() {
      const input = document.getElementById('fileInput');
      const status = document.getElementById('status');
      const codeBlock = document.getElementById('codeBlock');

      if (!input.files[0]) {
        alert('è«‹é¸æ“‡ JSON æª”æ¡ˆ');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          const cleaned = deepClean(data);
          const output = JSON.stringify(cleaned, null, 2);
          codeBlock.textContent = output;

          const blob = new Blob([output], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "cleaned_verified.json";
          a.click();
          status.textContent = "âœ… æ¸…é™¤æˆåŠŸï¼Œæ¡£æ¡ˆå·²ä¸‹è½½ï¼Œå†…å®¹æ˜¾ç¤ºå¦‚ä¸‹ï¼š";
        } catch (err) {
          alert("âš ï¸ JSON æ ¼å¼é”™è¯¯ï¼Œè¯·ç¡®è®¤æ¡£æ¡ˆå†…å®¹æ­£ç¡®");
        }
      };
      reader.readAsText(input.files[0]);
    }
  </script>
</body>
</html>
